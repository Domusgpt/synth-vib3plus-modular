class E{constructor(){console.log("âš¡ Initializing Modular Reactivity Manager"),this.enabled=!0,this.mouseEnabled=!0,this.clickEnabled=!0,this.scrollEnabled=!0,this.activeSystem=null,this.activeSystemName="faceted",this.mouseModes={},this.clickModes={},this.scrollModes={},this.currentMouseMode="rotations",this.currentClickMode="ripple",this.currentScrollMode="cycle",setTimeout(()=>this.initializeModes(),0),this.setupGlobalListeners()}initializeModes(){try{this.mouseModes={rotations:new m,velocity:new g,distance:new v,mixed_faceted_holo:new k},this.clickModes={burst:new y,blast:new p,ripple:new F,mixed_multi:new C},this.scrollModes={cycle:new w,wave:new x,sweep:new b,mixed_blend:new A},console.log("âš¡ ReactivityManager modes initialized successfully")}catch(t){console.error("âŒ Failed to initialize ReactivityManager modes:",t)}}setActiveSystem(t,s){console.log(`âš¡ Reactivity switching to: ${t}`),this.activeSystemName=t,this.activeSystem=s,this.autoSelectDefaults(t)}autoSelectDefaults(t){const s={faceted:{mouse:"rotations",click:"ripple",scroll:"cycle"},quantum:{mouse:"velocity",click:"blast",scroll:"wave"},holographic:{mouse:"distance",click:"burst",scroll:"sweep"},polychora:{mouse:"rotations",click:"burst",scroll:"cycle"}};s[t]&&(this.currentMouseMode=s[t].mouse,this.currentClickMode=s[t].click,this.currentScrollMode=s[t].scroll,console.log(`âš¡ Auto-selected modes for ${t}: ${this.currentMouseMode}, ${this.currentClickMode}, ${this.currentScrollMode}`))}setupGlobalListeners(){console.log("âš¡ Setting up global reactivity listeners"),document.addEventListener("mousemove",t=>this.handleGlobalMouseMove(t)),document.addEventListener("click",t=>this.handleGlobalClick(t)),document.addEventListener("touchmove",t=>this.handleGlobalTouchMove(t)),document.addEventListener("touchend",t=>this.handleGlobalTouchEnd(t)),document.addEventListener("wheel",t=>this.handleGlobalWheel(t))}handleGlobalMouseMove(t){if(!this.enabled||!this.mouseEnabled||!this.isCanvasEvent(t))return;const s=this.getEventCoords(t);if(!s)return;const e=this.mouseModes&&this.mouseModes[this.currentMouseMode];e&&e.handleMouseMove&&e.handleMouseMove(s.x,s.y,this.updateParameter.bind(this))}handleGlobalClick(t){if(!this.enabled||!this.clickEnabled||!this.isCanvasEvent(t))return;const s=this.getEventCoords(t);if(!s)return;const e=this.clickModes&&this.clickModes[this.currentClickMode];e&&e.handleClick&&e.handleClick(s.x,s.y,this.updateParameter.bind(this))}handleGlobalWheel(t){if(!this.enabled||!this.scrollEnabled||!this.isCanvasEvent(t))return;t.preventDefault();const s=this.scrollModes&&this.scrollModes[this.currentScrollMode];s&&s.handleWheel&&s.handleWheel(t.deltaY,this.updateParameter.bind(this))}isCanvasEvent(t){const s=t.target;return s.tagName==="CANVAS"&&s.classList.contains("visualization-canvas")}getEventCoords(t){const s=t.target;if(!s)return null;const e=s.getBoundingClientRect(),o=(t.clientX-e.left)/e.width,n=(t.clientY-e.top)/e.height;return{x:o,y:n}}handleGlobalTouchMove(t){if(!(!this.enabled||!this.mouseEnabled||!this.isCanvasEvent(t))&&(t.preventDefault(),t.touches.length>0)){const s=t.touches[0],e=t.target.getBoundingClientRect(),o=(s.clientX-e.left)/e.width,n=(s.clientY-e.top)/e.height,i=this.mouseModes&&this.mouseModes[this.currentMouseMode];i&&i.handleMouseMove&&i.handleMouseMove(o,n,this.updateParameter.bind(this))}}handleGlobalTouchEnd(t){if(!(!this.enabled||!this.clickEnabled||!this.isCanvasEvent(t))&&t.changedTouches.length>0){const s=t.changedTouches[0],e=t.target.getBoundingClientRect(),o=(s.clientX-e.left)/e.width,n=(s.clientY-e.top)/e.height,i=this.clickModes&&this.clickModes[this.currentClickMode];i&&i.handleClick&&i.handleClick(o,n,this.updateParameter.bind(this))}}updateParameter(t,s){window.updateParameter&&window.updateParameter(t,s),console.log(`âš¡ ${this.activeSystemName} reactivity: ${t} = ${s}`)}toggleMouse(t){this.mouseEnabled=t,console.log(`âš¡ Mouse reactivity: ${t?"ON":"OFF"}`)}toggleClick(t){this.clickEnabled=t,console.log(`âš¡ Click reactivity: ${t?"ON":"OFF"}`)}toggleScroll(t){this.scrollEnabled=t,console.log(`âš¡ Scroll reactivity: ${t?"ON":"OFF"}`)}setMouseMode(t){this.mouseModes&&this.mouseModes[t]?(this.currentMouseMode=t,console.log(`âš¡ Mouse mode: ${t}`)):console.error(`âŒ Mouse mode '${t}' not found. Available modes:`,Object.keys(this.mouseModes||{}))}setClickMode(t){this.clickModes&&this.clickModes[t]&&(this.currentClickMode=t,console.log(`âš¡ Click mode: ${t}`))}setScrollMode(t){this.scrollModes&&this.scrollModes[t]&&(this.currentScrollMode=t,console.log(`âš¡ Scroll mode: ${t}`))}setMultiMouseModes(t){this.activeMouseModes=t,console.log(`âš¡ Multi-mouse modes active: ${t.length} modes`)}setMultiClickModes(t){this.activeClickModes=t,console.log(`âš¡ Multi-click modes active: ${t.length} modes`)}setMultiScrollModes(t){this.activeScrollModes=t,console.log(`âš¡ Multi-scroll modes active: ${t.length} modes`)}setEnabled(t){this.enabled=t,console.log(`âš¡ Global reactivity: ${t?"ON":"OFF"}`)}}class m{constructor(){this.lastPosition={x:.5,y:.5},this.scrollHue=200}handleMouseMove(t,s,e){const n=(t-.5)*12.56,i=(t-.5)*12.56*.7,c=(s-.5)*12.56,l=(t-.5)*30,a=(this.scrollHue+l)%360;e("rot4dXW",n.toFixed(2)),e("rot4dYW",i.toFixed(2)),e("rot4dZW",c.toFixed(2)),e("hue",Math.round(a))}}class g{constructor(){this.lastPosition={x:.5,y:.5},this.velocityHistory=[]}handleMouseMove(t,s,e){const o=t-this.lastPosition.x,n=s-this.lastPosition.y,i=Math.sqrt(o*o+n*n);this.velocityHistory.push(i),this.velocityHistory.length>5&&this.velocityHistory.shift();const c=this.velocityHistory.reduce((M,f)=>M+f,0)/this.velocityHistory.length,l=Math.min(1,c*30),a=.5+Math.min(2.5,c*15),r=10+s*90,d=.4+t*.6,u=(280+c*80)%360;e("chaos",l.toFixed(2)),e("speed",a.toFixed(2)),e("gridDensity",Math.round(r)),e("intensity",d.toFixed(2)),e("hue",Math.round(u)),this.lastPosition={x:t,y:s}}}class v{handleMouseMove(t,s,e){const i=Math.sqrt((t-.5)**2+(s-.5)**2),c=Math.min(i/.707,1),l=5+95*c,a=.2+.8*(1-c),r=.4+.6*(1-c),d=(320+c*40)%360;e("gridDensity",Math.round(l)),e("intensity",a.toFixed(2)),e("saturation",r.toFixed(2)),e("hue",Math.round(d))}}class y{constructor(){this.isAnimating=!1,this.effects={}}handleClick(t,s,e){this.effects={colorFlash:1,chaosBoost:.8,speedBoost:1.5},this.isAnimating||this.startAnimation(e)}startAnimation(t){this.isAnimating=!0;const s=()=>{let e=!1;this.effects.colorFlash>.01&&(e=!0,this.effects.colorFlash*=.94),this.effects.chaosBoost>.01&&(e=!0,t("chaos",(.2+this.effects.chaosBoost).toFixed(2)),this.effects.chaosBoost*=.92),this.effects.speedBoost>.01&&(e=!0,t("speed",(1+this.effects.speedBoost).toFixed(2)),this.effects.speedBoost*=.91),e?requestAnimationFrame(s):this.isAnimating=!1};s()}}class p{constructor(){this.isAnimating=!1,this.effects={}}handleClick(t,s,e){this.effects={flashIntensity:1,chaosBlast:.7,speedWave:2,hueShift:60},this.isAnimating||this.startAnimation(e)}startAnimation(t){this.isAnimating=!0;const s=()=>{let e=!1;Object.keys(this.effects).forEach(o=>{if(this.effects[o]>.01)switch(e=!0,o){case"chaosBlast":t("chaos",Math.min(1,.3+this.effects[o]).toFixed(2)),this.effects[o]*=.88;break;case"speedWave":t("speed",Math.min(3,1+this.effects[o]).toFixed(2)),this.effects[o]*=.89;break;case"hueShift":t("hue",Math.round((280+this.effects[o])%360)),this.effects[o]*=.9;break}}),e?requestAnimationFrame(s):this.isAnimating=!1};s()}}class F{constructor(){this.morphIntensity=0,this.baseMorph=1,this.isAnimating=!1}handleClick(t,s,e){const i=Math.sqrt((t-.5)**2+(s-.5)**2),c=Math.min(i/.707,1);this.morphIntensity=.1+.2*(1-c),this.isAnimating||this.startAnimation(e)}startAnimation(t){this.isAnimating=!0;const s=()=>{if(this.morphIntensity>.01){const e=this.baseMorph+this.morphIntensity;t("morphFactor",e.toFixed(2)),this.morphIntensity*=.9,requestAnimationFrame(s)}else t("morphFactor",this.baseMorph.toFixed(2)),this.isAnimating=!1};s()}}class w{constructor(){this.scrollDensity=15,this.scrollHue=200}handleWheel(t,s){const e=t>0?1:-1;this.scrollDensity+=e*.8,this.scrollDensity=Math.max(5,Math.min(100,this.scrollDensity)),this.scrollHue+=e*3,this.scrollHue=(this.scrollHue%360+360)%360,s("gridDensity",Math.round(this.scrollDensity)),s("hue",Math.round(this.scrollHue))}}class x{constructor(){this.scrollMorph=1}handleWheel(t,s){const e=t>0?1:-1;this.scrollMorph+=e*.02,this.scrollMorph=Math.max(.2,Math.min(2,this.scrollMorph)),s("morphFactor",this.scrollMorph.toFixed(2))}}class b{constructor(){this.sweepParameter=0,this.sweepValues=[200,.5,.8,.2,1]}handleWheel(t,s){const e=t>0?1:-1,o=["hue","intensity","saturation","chaos","speed"],n=[[0,360],[.1,1],[.1,1],[0,1],[.1,3]],i=this.sweepParameter,[c,l]=n[i],a=(l-c)*.02;this.sweepValues[i]+=e*a,this.sweepValues[i]=Math.max(c,Math.min(l,this.sweepValues[i])),s(o[i],this.sweepValues[i].toFixed(2)),Math.random()<.1&&(this.sweepParameter=(this.sweepParameter+1)%o.length)}}class k{constructor(){this.scrollHue=240,this.lastPosition={x:.5,y:.5}}handleMouseMove(t,s,e){console.log("ðŸŒˆ MIXED MODE: Mouse move at",t.toFixed(3),s.toFixed(3));const o=6.28*1.5,n=(t-.5)*o,i=(t-.5)*o*.7,c=(s-.5)*o,r=Math.sqrt((t-.5)**2+(s-.5)**2),d=Math.min(r/.707,1),u=15+70*d,M=.3+.7*(1-d),f=(300+d*60)%360;console.log("ðŸŒˆ MIXED applying:",{rot4dXW:n.toFixed(2),rot4dYW:i.toFixed(2),rot4dZW:c.toFixed(2),gridDensity:Math.round(u),intensity:M.toFixed(2),hue:Math.round(f)}),e("rot4dXW",n.toFixed(2)),e("rot4dYW",i.toFixed(2)),e("rot4dZW",c.toFixed(2)),e("gridDensity",Math.round(u)),e("intensity",M.toFixed(2)),e("hue",Math.round(f)),this.lastPosition={x:t,y:s}}}class C{constructor(){this.effects={},this.isAnimating=!1}handleClick(t,s,e){const i=Math.sqrt((t-.5)**2+(s-.5)**2),c=Math.min(i/.707,1);this.effects={colorFlash:.8,chaosBoost:.6,speedBoost:1.3,flashIntensity:.9,hueShift:45,morphIntensity:.15+.15*(1-c)},this.isAnimating||this.startAnimation(e)}startAnimation(t){this.isAnimating=!0;let s=0;const e=()=>{s++;const o=s/30,n=Math.exp(-o*3);if(o<1){const i=.2+this.effects.chaosBoost*n,c=1+this.effects.speedBoost*n,l=.5+this.effects.flashIntensity*n,a=this.effects.morphIntensity*n,r=(240+this.effects.hueShift*Math.sin(o*Math.PI*4))%360;t("chaos",i.toFixed(2)),t("speed",c.toFixed(2)),t("intensity",l.toFixed(2)),t("morphFactor",a.toFixed(2)),t("hue",Math.round(r)),requestAnimationFrame(e)}else this.isAnimating=!1};requestAnimationFrame(e)}}class A{constructor(){this.cycleGeometry=0,this.waveValues={chaos:.5,speed:1},this.sweepValues=[240,.5,.5,.5,1],this.sweepParameter=0}handleWheel(t,s){const e=t>0?1:-1;if(Math.random()<.3&&(this.cycleGeometry=(this.cycleGeometry+e+8)%8,s("geometry",this.cycleGeometry)),Math.random()<.4&&(this.waveValues.chaos+=e*.05,this.waveValues.speed+=e*.1,this.waveValues.chaos=Math.max(0,Math.min(1,this.waveValues.chaos)),this.waveValues.speed=Math.max(.1,Math.min(3,this.waveValues.speed)),s("chaos",this.waveValues.chaos.toFixed(2)),s("speed",this.waveValues.speed.toFixed(2))),Math.random()<.5){const o=["hue","intensity","saturation","gridDensity","morphFactor"],n=[[0,360],[.1,1],[.1,1],[10,90],[0,1.5]],i=this.sweepParameter,[c,l]=n[i],a=(l-c)*.03;this.sweepValues[i]+=e*a,this.sweepValues[i]=Math.max(c,Math.min(l,this.sweepValues[i])),s(o[i],this.sweepValues[i].toFixed(2)),Math.random()<.15&&(this.sweepParameter=(this.sweepParameter+1)%o.length)}}}export{E as ReactivityManager};
