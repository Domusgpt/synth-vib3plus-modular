class u{constructor(){this.currentSystem=null,this.currentEngine=null}async switchToSystem(o,n){console.log(`ğŸ”„ DESTROY OLD â†’ CREATE NEW: ${o}`),this.currentEngine&&(this.currentEngine.setActive&&this.currentEngine.setActive(!1),this.currentEngine.destroy&&this.currentEngine.destroy(),console.log("ğŸ’¥ Old engine destroyed")),this.destroyOldWebGLContexts(),this.destroyAllCanvasesAndCreateFresh(o);const e=await this.createFreshEngine(o,n);return e&&e.setActive&&e.setActive(!0),this.currentSystem=o,this.currentEngine=e,console.log(`âœ… DESTROY â†’ CREATE complete: ${o} ready`),e}destroyOldWebGLContexts(){console.log("ğŸ’¥ COMPLETE DESTRUCTION: WebGL contexts + old system cleanup...");const o=document.querySelectorAll("canvas");let n=0;o.forEach(e=>{const r=e.getContext("webgl2")||e.getContext("webgl");if(r){const i=r.getExtension("WEBGL_lose_context");i&&(i.loseContext(),n++)}}),window.engine&&(console.log("ğŸ’¥ Clearing window.engine"),window.engine=null),window.quantumEngine&&(console.log("ğŸ’¥ Clearing window.quantumEngine"),window.quantumEngine=null),window.holographicSystem&&(console.log("ğŸ’¥ Clearing window.holographicSystem"),window.holographicSystem=null),window.polychoraSystem&&(console.log("ğŸ’¥ Clearing window.polychoraSystem"),window.polychoraSystem=null),console.log(`ğŸ’¥ DESTRUCTION COMPLETE: ${n} WebGL contexts destroyed, all engine refs cleared`)}destroyAllCanvasesAndCreateFresh(o){console.log("ğŸ’¥ DESTROYING ALL CANVASES + CREATING 5 FRESH ONES");const n=document.querySelectorAll("canvas");n.forEach(a=>a.remove()),console.log(`ğŸ’¥ Destroyed ${n.length} old canvases`),["vib34dLayers","quantumLayers","holographicLayers","polychoraLayers"].forEach(a=>{const l=document.getElementById(a);l&&(l.innerHTML="",l.style.display="none")});const r=o==="faceted"?"vib34dLayers":`${o}Layers`,i=document.getElementById(r);if(!i){console.error(`âŒ Container ${r} not found`);return}const c=this.getCanvasIdsForSystem(o);c.forEach((a,l)=>{const t=document.createElement("canvas");t.id=a,t.className="visualization-canvas",t.style.position="absolute",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.zIndex=l+1;const g=window.innerWidth,d=window.innerHeight,s=Math.min(window.devicePixelRatio||1,2);t.width=g*s,t.height=d*s,i.appendChild(t)}),i.style.display="block",i.style.visibility="visible",i.style.opacity="1",console.log(`âœ… Created 5 fresh canvases for ${o}: ${c.join(", ")}`)}getCanvasIdsForSystem(o){const n=["background-canvas","shadow-canvas","content-canvas","highlight-canvas","accent-canvas"];switch(o){case"faceted":return n;case"quantum":return n.map(e=>`quantum-${e}`);case"holographic":return n.map(e=>`holo-${e}`);case"polychora":return n.map(e=>`polychora-${e}`);default:return n}}async createFreshEngine(o,n){console.log(`ğŸš€ Creating fresh ${o} engine`);let e=null;try{switch(o){case"faceted":n.VIB34DIntegratedEngine&&(e=new n.VIB34DIntegratedEngine,window.engine=e,console.log("âœ… Fresh Faceted engine"));break;case"quantum":n.QuantumEngine&&(e=new n.QuantumEngine,window.quantumEngine=e,console.log("âœ… Fresh Quantum engine"));break;case"holographic":n.RealHolographicSystem&&(e=new n.RealHolographicSystem,window.holographicSystem=e,console.log("âœ… Fresh Holographic engine"));break;case"polychora":n.NewPolychoraEngine&&(e=new n.NewPolychoraEngine,window.newPolychoraEngine=e,console.log("âœ… Fresh TRUE 4D Polychora Engine with VIB34D DNA"));break;default:console.error(`âŒ Unknown system: ${o}`)}}catch(r){console.error(`ğŸ’¥ Engine creation failed for ${o}:`,r),e=null}return e}}export{u as CanvasManager};
